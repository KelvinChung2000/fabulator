# FABulator VS Code Extension

A VS Code extension for visualizing and exploring FPGA fabrics generated by the FABulous framework.

## Features

- Interactive fabric visualization using Pixi.js
- Load and explore geometry CSV files
- Load and visualize FASM bitstream configurations
- Integrated with VS Code's file explorer and command palette
- Auto-start FABulous CLI terminal if a workspace folder contains a `.FABulous` directory
- Manual command to start FABulous CLI from any selected project path
- Remember and manage multiple FABulous project paths
- Smart Fabric loading: auto-detect geometry CSV when one project, quick pick when multiple

## Development

### Prerequisites

- Node.js 18+ 
- VS Code

### Setup

1. Install extension dependencies:
   ```bash
   npm install
   ```

2. Install webview UI dependencies:
   ```bash
   cd webview-ui
   npm install
   ```

### Development Workflow

1. **Development Mode**: 
   - Start the webview UI development server: `cd webview-ui && npm run dev`
   - Set `NODE_ENV=development` in launch configuration
   - Press F5 to start debugging

2. **Production Mode**:
   - Build webview UI: `cd webview-ui && npm run build`
   - Compile extension: `npm run compile`
   - Press F5 to test

### Architecture

- **Extension Host** (`src/`): TypeScript code running in Node.js
- **Webview UI** (`webview-ui/`): React + Pixi.js application built with Vite
- **Communication**: Message passing between extension and webview

### Building

```bash
# Build webview UI
cd webview-ui && npm run build

# Compile extension
npm run compile
```

## Usage

1. Open the Command Palette (`Cmd/Ctrl + Shift + P`)
2. Run "FABulator: Open Fabric" to load a geometry CSV file
3. Run "FABulator: Open Design" to load a FASM file
4. View the fabric in the Fabric Viewer panel in the Explorer sidebar
5. (Optional) If your workspace contains a `.FABulous` folder, the extension will automatically start a terminal running the `FABulous` CLI.
6. To manually start the CLI, run "FABulator: Start FABulous CLI" and choose (or create) a FABulous project directory.

### FABulous CLI Integration

The extension detects FABulous projects by the presence of a `.FABulous` directory at a workspace root. On first activation it will open an integrated terminal (named `FABulous`) and execute the `FABulous` command (ensure it is on your PATH / installed in the active environment). You can start it manually any time via the command palette.

The terminal is only auto-created once per session (flag stored in global state). To force re-run, close VS Code or clear the `fabulator.fabulousStarted` global state key.

### Project Paths & Smart Fabric Loading

Use "FABulator: Add Project Path" (or the + button in the Projects view) to remember a FABulous project directory. The Projects view lists all remembered paths; remove with the inline X.

Run "FABulator: Show Fabric (Smart)":
- If no projects are stored: you'll be prompted to add one.
- If one project exists: the extension auto-detects a geometry CSV (searching for `geometry.csv` or `eFPGA_geometry.csv` in project root, `demo/`, `demo/Fabric/`, or `Fabric/`). If found it loads directly; otherwise it prompts for manual selection.
- If multiple projects exist: a quick pick lets you choose which project to visualize; then the same auto-detection runs.

This streamlines switching among multiple FABulous projects without manually browsing for geometry files each time.

## Architecture Overview

This extension converts the original JavaFX-based FABulator application to a VS Code extension using modern web technologies:

- **JavaFX Groups** → **Pixi.js Containers**
- **JavaFX Shapes** → **Pixi.js Graphics API**
- **JavaFX Event Handling** → **React + Pixi.js Interaction**

## Current Status

- ✅ Complete extension structure with webview
- ✅ Vite-based build system for fast development  
- ✅ Pixi.js v8 integration with WebGL rendering
- ✅ VS Code command integration and file dialogs
- ✅ Complete TypeScript geometry parser
- ✅ Full fabric visualization with real eFPGA support
- ✅ Interactive tile exploration and color coding
- ✅ Tested with production 16×10 eFPGA fabric (470KB file)

## Testing

The extension has been **fully tested** with a real eFPGA geometry file:
- **Fabric Size**: 16×10 tiles (3018×4770 pixels)
- **Tile Types**: 14 different types (LUT4AB, DSP, RAM_IO, etc.)
- **Performance**: Smooth parsing and rendering of complex fabrics

See [TESTING.md](TESTING.md) for detailed testing instructions.
